{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-5">
    <div class="card shadow-lg mx-auto" style="max-width: 600px;">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0 text-center">COPD Prediction</h3>
        </div>
        <div class="card-body">
            <form id="predictionForm" action="{% url 'predict_disease' %}" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="mb-4">
                    <label for="name" class="form-label">Full Name</label>
                    <input type="text" class="form-control" id="name" name="name" required placeholder="Enter your full name">
                </div>
                <div class="mb-4">
                    <label for="age" class="form-label">Age</label>
                    <input type="number" class="form-control" id="age" name="age" required placeholder="Enter your age">
                </div>
                <div class="mb-4">
                    <label for="voice" class="form-label">Voice Sample</label>
                    <input type="file" class="form-control" id="voice" name="voice" accept=".mp3,.wav" required>
                    <div class="form-text">Please upload a clear voice recording</div>
                </div>
                <button type="submit" id="submitBtn" class="btn btn-primary w-100 py-2">Submit for Analysis</button>
            </form>

            <div id="loading" class="text-center mt-3" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Processing your voice sample...</p>
            </div>

            <div id="resultSection" class="mt-4 text-center" style="display: none;">
                <h4>Prediction Result</h4>
                <p id="predictionResult" class="lead fw-bold"></p>
                <p id="specialistAdvice" class="mt-3"></p>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('predictionForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const resultSection = document.getElementById('resultSection');
        const predictionResult = document.getElementById('predictionResult');
        const specialistAdvice = document.getElementById('specialistAdvice');
    
        // Show loading spinner with animation
        submitBtn.disabled = true;
        loading.style.display = 'block';
    
        // Submit form data with animation
        const formData = new FormData(this);
        fetch("{% url 'predict_disease' %}", {  // Ensure this URL exists in urls.py
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())  // Expecting JSON response with prediction
        .then(data => {
            loading.style.display = 'none';
            submitBtn.disabled = false;
            
            if (data.error) {
                alert("Error: " + data.error);
            } else {
                // Display prediction result with fade-in animation
                predictionResult.textContent = data.prediction;
                resultSection.style.opacity = 1;
                resultSection.style.display = 'block';
                
                
                
            }
        })
        .catch(error => {
            console.error('Error:', error);
            loading.style.display = 'none';
            submitBtn.disabled = false;
            alert('An error occurred: ' + error.message);
        });
    });
</script>

<style>
    /* General container styling */
    .container {
        background: linear-gradient(135deg, #f8f9fa, #e3f2fd);
        border-radius: 10px;
        padding: 40px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        
    }

    /* Card Header Styling */
    .card-header {
        background-color: #007bff;
        color: white;
        font-weight: bold;
        border-radius: 8px 8px 0 0;
        animation: slideInTop 1s ease-out;
    }

    .card-header h3 {
        font-size: 1.5rem;
    }

    /* Form Input Styling */
    .form-control {
        border-radius: 8px;
        border: 1px solid #ccc;
        padding: 12px 15px;
        font-size: 1rem;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
        animation: fadeInUp 0.5s ease-out;
    }

    /* Button Styling */
    .btn-primary {
        border-radius: 25px;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        animation: fadeInUp 0.5s ease-out;
    }

    

    /* Loading Spinner */
    #loading {
        display: none;
        animation: fadeIn 1s ease-in-out;
    }

    /* Prediction result styling */
    #resultSection {
        display: none;
        margin-top: 20px;
        opacity: 0;
        transition: opacity 1s ease-in-out;
    }

    #predictionResult {
        color: #007bff;
        font-size: 1.25rem;
        font-weight: 600;
    }

    /* Specialist Advice Styling */
    #specialistAdvice {
        font-size: 1.1rem;
        margin-top: 15px;
        color: #333;
        font-weight: 500;
    }

    .lead {
        font-size: 1.25rem;
        font-weight: 500;
    }

    /* Form text styling for voice sample */
    .form-text {
        color: #6c757d;
    }

    

    .form-control:focus {
        box-shadow: 0 0 8px rgba(0, 123, 255, 0.75);
        border-color: #007bff;
    }

    /* Responsive design adjustments */
    @media (max-width: 767px) {
        .container {
            padding: 20px;
        }
        
        .card {
            padding: 15px;
        }

        .btn-primary {
            font-size: 1rem;
        }

        .form-control {
            padding: 10px 12px;
        }
    }

    /* Animation keyframes */
    @keyframes fadeIn {
        0% { opacity: 0; }
        100% { opacity: 1; }
    }

   

    @keyframes slideInTop {
        0% { transform: translateY(-30px); }
        100% { transform: translateY(0); }
    }

</style>

{% endblock %}
